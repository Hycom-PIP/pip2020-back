pipeline {
    agent any
    stages {
      stage('Build') {
                steps {
                    sh 'mvn clean install -DskipTests'
                }
            }
      stage('Run') {
                steps {
                     sh 'export BUILD_ID=dontKillMe'
                     sh 'export JENKINS_NODE_COOKIE=dontKillMe'

                     sh ' java -jar -Dspring.profiles.active=fullTests api/target/api.jar &'
                     sh 'sleep 10s'
                     dir('integration-tests') {
                             sh 'mvn test -PfullTests'
                     }
                }
            }
    }
}

