pipeline {
    agent any
    stages {
      stage('Build') {
                steps {
                    sh 'mvn clean install -DskipTests'
                }
            }
      stage('Run') {
                steps {

                     sh ' java -jar -Dspring.profiles.active=fullTests api/target/api.jar &'

                     sh '''#!/bin/bash
                     while :
                     do
                     	if [ "$(curl --silent http://localhost:8081/hello &)" ]; then
                                     break
                         fi
                     done
                     '''

                     dir('integration-tests') {
                             sh 'mvn test -PfullTests'
                     }
                }
            }
    }
}

