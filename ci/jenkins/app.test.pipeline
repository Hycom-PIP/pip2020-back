pipeline {
    agent any
    stages {
      stage('Build') {
                steps {
                    sh 'mvn clean install -DskipTests'
                }
            }
      stage('Run') {
                steps {

                     sh ' java -jar -Dspring.profiles.active=fullTests api/target/api.jar &'

                     sh '''#!/bin/bash
                     while :
                     do
                     	if [ "$(netstat -an | grep 'LISTENING' | grep '8081')" ]; then
                                     break
                             fi
                     done
                     '''

                     dir('integration-tests') {
                             sh 'mvn test -PfullTests'
                     }
                }
            }
    }
}

